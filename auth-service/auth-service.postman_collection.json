{
    "info": {
      "name": "Auth Service API",
      "description": "Colección completa para probar el microservicio de autenticación con JWT y Google OAuth",
      "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
    },
    "variable": [
      {
        "key": "base_url",
        "value": "http://localhost:3000",
        "type": "string"
      },
      {
        "key": "token",
        "value": "",
        "type": "string"
      }
    ],
    "item": [
      {
        "name": "Health Check",
        "request": {
          "method": "GET",
          "header": [],
          "url": {
            "raw": "{{base_url}}/health",
            "host": ["{{base_url}}"],
            "path": ["health"]
          },
          "description": "Verificar que el servicio está funcionando"
        },
        "response": []
      },
      {
        "name": "Register User",
        "event": [
          {
            "listen": "test",
            "script": {
              "exec": [
                "if (pm.response.code === 201) {",
                "    const response = pm.response.json();",
                "    if (response.data && response.data.token) {",
                "        pm.collectionVariables.set('token', response.data.token);",
                "        console.log('Token guardado:', response.data.token);",
                "    }",
                "}"
              ],
              "type": "text/javascript"
            }
          }
        ],
        "request": {
          "method": "POST",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": {
            "mode": "raw",
            "raw": "{\n  \"email\": \"usuario@ejemplo.com\",\n  \"password\": \"password123\",\n  \"name\": \"Usuario Prueba\"\n}"
          },
          "url": {
            "raw": "{{base_url}}/auth/register",
            "host": ["{{base_url}}"],
            "path": ["auth", "register"]
          },
          "description": "Registrar un nuevo usuario. El token JWT se guarda automáticamente."
        },
        "response": []
      },
      {
        "name": "Login",
        "event": [
          {
            "listen": "test",
            "script": {
              "exec": [
                "if (pm.response.code === 200) {",
                "    const response = pm.response.json();",
                "    if (response.data && response.data.token) {",
                "        pm.collectionVariables.set('token', response.data.token);",
                "        console.log('Token guardado:', response.data.token);",
                "    }",
                "}"
              ],
              "type": "text/javascript"
            }
          }
        ],
        "request": {
          "method": "POST",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": {
            "mode": "raw",
            "raw": "{\n  \"email\": \"usuario@ejemplo.com\",\n  \"password\": \"password123\"\n}"
          },
          "url": {
            "raw": "{{base_url}}/auth/login",
            "host": ["{{base_url}}"],
            "path": ["auth", "login"]
          },
          "description": "Iniciar sesión con email y password. El token JWT se guarda automáticamente."
        },
        "response": []
      },
      {
        "name": "Login with Google",
        "event": [
          {
            "listen": "test",
            "script": {
              "exec": [
                "if (pm.response.code === 200) {",
                "    const response = pm.response.json();",
                "    if (response.data && response.data.token) {",
                "        pm.collectionVariables.set('token', response.data.token);",
                "        console.log('Token guardado:', response.data.token);",
                "    }",
                "}"
              ],
              "type": "text/javascript"
            }
          }
        ],
        "request": {
          "method": "POST",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": {
            "mode": "raw",
            "raw": "{\n  \"token\": \"GOOGLE_ID_TOKEN_AQUI\"\n}"
          },
          "url": {
            "raw": "{{base_url}}/auth/google",
            "host": ["{{base_url}}"],
            "path": ["auth", "google"]
          },
          "description": "Login con Google OAuth2. Reemplaza GOOGLE_ID_TOKEN_AQUI con el token obtenido desde el frontend."
        },
        "response": []
      },
      {
        "name": "Get Profile",
        "request": {
          "auth": {
            "type": "bearer",
            "bearer": [
              {
                "key": "token",
                "value": "{{token}}",
                "type": "string"
              }
            ]
          },
          "method": "GET",
          "header": [],
          "url": {
            "raw": "{{base_url}}/auth/me",
            "host": ["{{base_url}}"],
            "path": ["auth", "me"]
          },
          "description": "Obtener el perfil del usuario autenticado. Requiere el token JWT (se usa automáticamente)."
        },
        "response": []
      },
      {
        "name": "Register (Error - Email duplicado)",
        "request": {
          "method": "POST",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": {
            "mode": "raw",
            "raw": "{\n  \"email\": \"usuario@ejemplo.com\",\n  \"password\": \"password123\",\n  \"name\": \"Usuario Duplicado\"\n}"
          },
          "url": {
            "raw": "{{base_url}}/auth/register",
            "host": ["{{base_url}}"],
            "path": ["auth", "register"]
          },
          "description": "Probar error cuando se intenta registrar un email que ya existe."
        },
        "response": []
      },
      {
        "name": "Login (Error - Credenciales inválidas)",
        "request": {
          "method": "POST",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": {
            "mode": "raw",
            "raw": "{\n  \"email\": \"usuario@ejemplo.com\",\n  \"password\": \"password-incorrecta\"\n}"
          },
          "url": {
            "raw": "{{base_url}}/auth/login",
            "host": ["{{base_url}}"],
            "path": ["auth", "login"]
          },
          "description": "Probar error con contraseña incorrecta."
        },
        "response": []
      },
      {
        "name": "Register (Error - Validación)",
        "request": {
          "method": "POST",
          "header": [
            {
              "key": "Content-Type",
              "value": "application/json"
            }
          ],
          "body": {
            "mode": "raw",
            "raw": "{\n  \"email\": \"email-invalido\",\n  \"password\": \"123\"\n}"
          },
          "url": {
            "raw": "{{base_url}}/auth/register",
            "host": ["{{base_url}}"],
            "path": ["auth", "register"]
          },
          "description": "Probar errores de validación (email inválido, password muy corto)."
        },
        "response": []
      },
      {
        "name": "Get Profile (Error - Sin token)",
        "request": {
          "method": "GET",
          "header": [],
          "url": {
            "raw": "{{base_url}}/auth/me",
            "host": ["{{base_url}}"],
            "path": ["auth", "me"]
          },
          "description": "Probar error 401 al acceder sin token de autenticación."
        },
        "response": []
      },
      {
        "name": "Get Profile (Error - Token inválido)",
        "request": {
          "auth": {
            "type": "bearer",
            "bearer": [
              {
                "key": "token",
                "value": "token-invalido-xyz",
                "type": "string"
              }
            ]
          },
          "method": "GET",
          "header": [],
          "url": {
            "raw": "{{base_url}}/auth/me",
            "host": ["{{base_url}}"],
            "path": ["auth", "me"]
          },
          "description": "Probar error 401 con token inválido."
        },
        "response": []
      }
    ]
  }